{"pageProps":{"note":{"id":"lw02n68zvdx7xmjtdn6ost0","title":"Python Asyncio","desc":"","updated":1674888188069,"created":1674884611859,"custom":{},"fname":"capture.dev.python.functional-programming.asynchrnous-programming.python-asyncio","type":"note","vault":{"fsPath":"vault"},"contentHash":"e972ec601f40951e271b42076cf7da22","links":[],"anchors":{"rules-of-asyncio":{"type":"header","text":"Rules of asyncio","value":"rules-of-asyncio","line":24,"column":0,"depth":2},"design-patterns":{"type":"header","text":"Design Patterns","value":"design-patterns","line":77,"column":0,"depth":2}},"children":[],"parent":"9iyitjbahuhp1l0cy75kxvv","data":{}},"body":"<h1 id=\"python-asyncio\">Python Asyncio<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#python-asyncio\"></a></h1>\n<ul>\n<li>python async IO is not threading, nor is it multiprocessing</li>\n<li>async IO is a single-threaded, single-process design: it uses <code>cooperative multitasking</code></li>\n</ul>\n<details>\n<summary>Simultaneous chess playing Example</summary>\n<ul>\n<li>Chess master Judit Polg√°r hosts a chess exhibition in which she plays multiple amateur players. She has two ways of conducting the exhibition: synchronously and asynchronously.</li>\n<li>Assumptions:\n<ul>\n<li>24 opponents</li>\n<li>Judit makes each chess move in 5 seconds</li>\n<li>Opponents each take 55 seconds to make a move</li>\n<li>Games average 30 pair-moves (60 moves total)</li>\n</ul>\n</li>\n<li><strong>Synchronous version</strong>: Judit plays one game at a time, never two at the same time, until the game is complete. Each game takes <strong>(55 + 5) * 30 == 1800</strong> seconds, or 30 minutes. The entire exhibition takes <strong>24 * 30 == 720</strong> minutes, or <strong>12 hours</strong>.</li>\n<li><strong>Asynchronous version</strong>: Judit moves from table to table, making one move at each table. She leaves the table and lets the opponent make their next move during the wait time. One move on all 24 games takes Judit <strong>24 * 5 == 120</strong> seconds, or 2 minutes. The entire exhibition is now cut down to <strong>120 * 30 == 3600</strong> seconds, or just <strong>1 hour</strong>. <a href=\"https://youtu.be/iG6fr81xHKA?t=4m29s\">(Source)</a></li>\n</ul>\n</details>\n<h2 id=\"rules-of-asyncio\">Rules of asyncio<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#rules-of-asyncio\"></a></h2>\n<ul>\n<li>syntax <code>async def</code> introduces either a <strong>native coroutine</strong> or an <strong>asynchronous generator</strong>\n<ul>\n<li>expressions <code>async with</code> and <code>async for</code> are also valid</li>\n</ul>\n</li>\n<li>keyword <code>await</code> passes function control back to the event loop.</li>\n</ul>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">g</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Pause here and come back to g() when f() is ready</span>\n    r <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> f<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> r\n</code></pre>\n<details>\n<summary>explanation</summary>\n<ul>\n<li>If Python encounters an <code>await f()</code> expression in the scope of <code>g()</code>, this is how <code>await</code> tells the event loop, ‚ÄúSuspend execution of <code>g()</code> until whatever I‚Äôm waiting on‚Äîthe result of <code>f()</code> ‚Äîis returned. In the meantime, go let something else run.‚Äù</li>\n</ul>\n</details>\n<ul>\n<li>function that you introduce with <code>async def</code> is a <strong>coroutine</strong>\n<ul>\n<li>To call a coroutine function, you must <code>await</code> it to get its results</li>\n<li>It is less common (and only recently legal in Python) to use <code>yield</code> in an <code>async def</code> block.\n<ul>\n<li>This creates an <a href=\"https://www.python.org/dev/peps/pep-0525/\">asynchronous generator</a>, which you iterate over with <code>async for</code>.</li>\n</ul>\n</li>\n<li>Anything defined with <code>async def</code> may not use <code>yield from</code>, which will raise a <code>SyntaxError</code>.</li>\n</ul>\n</li>\n<li>it is a <code>SyntaxError</code> to use <code>await</code> outside of an <code>async def</code> coroutine.</li>\n</ul>\n<details>\n<summary>code examples</summary>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    y <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> z<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># OK - `await` and `return` allowed in coroutines</span>\n    <span class=\"token keyword\">return</span> y\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">g</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">yield</span> x  <span class=\"token comment\"># OK - this is an async generator</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">m</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">yield</span> <span class=\"token keyword\">from</span> gen<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># No - SyntaxError</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">m</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    y <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> z<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Still no - SyntaxError (no `async def` here)</span>\n    <span class=\"token keyword\">return</span> y\n</code></pre>\n</details>\n<ul>\n<li>when you use <code>await f()</code>, it‚Äôs required that <code>f()</code> be an object that is <a href=\"https://docs.python.org/3/reference/datamodel.html#awaitable-objects\">awaitable</a></li>\n<li>an awaitable object is either\n<ol>\n<li>another coroutine or</li>\n<li>an object defining an <code>.__await__()</code> dunder method that returns an iterator</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"design-patterns\">Design Patterns<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#design-patterns\"></a></h2>","noteIndex":{"id":"LBE6GBZjFtOaX27nwRSpq","title":"Notes üìö","desc":"","updated":1642916746120,"created":1642875904363,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"f3ab1afac9d88a8f51c98f4e257b81a2","links":[],"anchors":{},"children":["H8OS9Ap2DDjZ7XSIZWpQT","m2fe4910vhlj3cwsbw45wfc","tpmpx2xkasjhbntai7ejfx3","ydBpHsjLwIGYomDZo8NtB","g9m1mlmymq7qvcjzi8ap2qu"],"parent":null,"data":{},"body":"\n![home](/assets/images/home.png)\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"dendronVersion":"0.83.0","enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false,"templateHierarchy":"template"},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"theme":"custom"},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"assetsPrefix":"/notes","copyAssets":true,"siteHierarchies":["root"],"enableSiteLastModified":true,"siteRootDir":"docs","siteUrl":"https://vinaykakkad.github.io","enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"writeStubs":false,"seo":{"title":"Notes","description":"Notes"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enablePrettyLinks":true,"enableTaskNotes":true,"theme":"custom","searchMode":"lookup","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}